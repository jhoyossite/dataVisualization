<!DOCTYPE html>
<meta charset="utf-8">
<style>
    .bar {
        fill: steelblue;
    }

    .bar:hover {
        fill: brown;
    }

    .axis--x path {
        display: none;
    }
    
    body{
        margin:20px;
    }
</style>
<head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="bootstrap-3.3.7-dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container"style="margin-top:40px;">
        <div class="jumbotron">
            <h1>Data visualization</h1>
            <p>Realizar una visualización basado en la base de datos de costos de proveedores a lo largo del tiempo en la empresa XXXXX S.A.</p>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Goal</div>
            <div class="panel-body">Presentar</div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">About data (What)</div>
            <div class="panel-body">Data description (What)</div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Task (Why)</div>
            <div class="panel-body">
                <span>T1. Tomar el presupuesto que se tiene por centro gestor para subcontrataciones y realiza comparación con el valor que se gasta en cada una.</span><br>
                <span>T2. Identificar los costos por categoría para cada centro gestor.</span><br>
                <span>T3. Categoría en la que más se gasta en subcontrataciones.</span><br>
                <span>T4. Visualizar a lo largo del tiempo los costos por proveedor, tener la posibilidad de filtrar por centro gestor o posición financiera o categoría.</span><br>
                <span>T5. Mostrar costos por año</span></div>
        </div>
        <div class="panel panel-default col-md-12">
            <div class="panel-body">
                <svg width="1000" height="400"></svg>
            </div>
        </div>
    </div>
</body>
<script>
    var svg    = d3.select("svg"),
        margin = {top: 20, right: 20, bottom: 30, left: 40},
        width  = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom;

    var x = d3.scaleBand().rangeRound([0, width]).padding(0.1),
        y = d3.scaleLinear().rangeRound([height, 0]);
      
    var g = svg.append("g")
               .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    function update(myData){
        x.domain(myData.map(function(d) { return d.key; }));
        y.domain([0, d3.max(myData, function(d) { return d.value; })]);

  		g.append("g")
      	 .attr("class", "axis axis--x")
      	 .attr("transform", "translate(0," + height + ")")
      	 .call(d3.axisBottom(x));

        g.append("g")
      	 .attr("class", "axis axis--y")
      	 .call(d3.axisLeft(y))
         .append("text")
      	 .attr("transform", "rotate(-90)")
      	 .attr("y", 6)
      	 .attr("dy", "0.71em")
      	 .attr("text-anchor", "end")
      	 .text("Valor neto");

        g.selectAll(".bar")
         .data(myData)
         .enter().append("rect")
      	 .attr("class", "bar")
      	 .attr("x", function(d) {return x(d.key); })
      	 .attr("y", function(d) {return y(d.value); })
      	 .attr("width", x.bandwidth())
      	 .attr("height", function(d) { return height - y(d.value); });

    }
    
    d3.json("prueba.json", function(err, data){
      var data2 = d3.nest()
                    .key(function(d) { return d["Ce gestor"]; })
                    .rollup(function(v) { return d3.sum(v, function(d) { return d["Valor neto"]; }); })
                    .entries(data);
    
        console.log(data2);

    update(data2);
})

/*d3.json("prueba.json", function(d) {
  //d["valor neto"] = +d["valor neto"];
  console.log(d);
  return d;
}, function(error, data) {
  if (error) throw error;
	console.log(data);
  x.domain(data.map(function(d) { return d.letter; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(y).ticks(10, "%"))
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .attr("text-anchor", "end")
      .text("Frequency");

  g.selectAll(".bar")
    .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.letter); })
      .attr("y", function(d) { return y(d.frequency); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height - y(d.frequency); });
});*/

  </script>
